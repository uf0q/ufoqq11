<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠ</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <style>
    :root {
      --primary-color: #1d3a3b;
      --secondary-color: #2a5b5d;
      --accent-color: #f4a261;
      --text-color: #ffd78f;
    }
    body {
      background-color: var(--primary-color);
      color: var(--text-color);
      font-family: 'Tajawal', sans-serif;
      margin-bottom: 200px;
    }
    .glass-container {
      background: rgba(42, 91, 93, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      border: 1px solid rgba(255, 215, 143, 0.2);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    .nav-tabs {
      border-bottom: 2px solid var(--accent-color);
    }
    .nav-link {
      transition: all 0.3s ease !important;
    }
    .nav-link.active {
      background: var(--accent-color) !important;
      color: #000 !important;
      transform: translateY(-2px);
    }
    .btn-primary {
      background: var(--accent-color);
      border: none;
      color: #000 !important;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(244, 162, 97, 0.4);
    }
    .btn-success {
      transition: all 0.3s ease;
    }
    .table-hover tbody tr {
      transition: all 0.3s ease;
    }
    .table-hover tbody tr:hover {
      transform: translateX(10px);
      background: rgba(255, 215, 143, 0.05);
    }
    .profit-card {
      background: rgba(29, 58, 59, 0.7);
      border-radius: 15px;
      padding: 20px;
    }
    .search-box {
      max-width: 300px;
      margin-bottom: 15px;
    }
    .messages-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(42, 91, 93, 0.9);
      border-top: 3px solid var(--accent-color);
      padding: 15px;
      border-radius: 10px 10px 0 0;
      max-height: 30%;
      overflow-y: auto;
      z-index: 999;
    }
    .owner-text {
      font-family: 'AbjadAlHawz', sans-serif;
      font-size: 1.5rem;
      color: var(--text-color);
      text-align: center;
      margin-bottom: 10px;
    }
    #preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--primary-color);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    #preloader h1 {
      color: var(--text-color);
      font-size: 2.5rem;
    }
  </style>
</head>
<body class="py-4">
  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠØ© -->
  <div id="preloader">
    <h1>Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ù…Ø¹ØªØµÙ…</h1>
  </div>
  
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ -->
  <div class="modal fade" id="passwordModal" tabindex="-1" role="dialog" aria-labelledby="passwordModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content glass-container">
        <div class="modal-header">
          <h5 class="modal-title" id="passwordModalLabel">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯</h5>
        </div>
        <div class="modal-body">
          <input type="password" id="sitePassword" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù‡Ù†Ø§">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div class="container glass-container">
    <!-- Ù‚Ø§Ø¦Ù…Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø© -->
    <div class="d-flex justify-content-end mb-3">
      <label for="currencySelector" class="mr-2" style="line-height: 2.2;">Ø§Ù„Ø¹Ù…Ù„Ø©:</label>
      <select id="currencySelector" class="form-control" style="max-width: 200px;">
        <option value="USD" data-rate="1" data-symbol="$">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
        <option value="SAR" data-rate="3.75" data-symbol="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
        <option value="OMR" data-rate="0.38" data-symbol="OMR">Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</option>
      </select>
    </div>
    
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">ğŸª Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠ</h2>
      <div class="d-flex gap-2">
        <button class="btn btn-primary" data-toggle="modal" data-target="#statsModal">
          ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </button>
        <button class="btn btn-success" onclick="exportSales()">
          ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        </button>
      </div>
    </div>
    
    <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <ul class="nav nav-tabs nav-justified mb-4">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#products">ğŸ·ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#sales">ğŸ’° Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#customers">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
      </li>
    </ul>
    
    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <div class="tab-content">
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
      <div class="tab-pane fade show active" id="products">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-primary" data-toggle="modal" data-target="#productModal" onclick="resetProductForm()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
          <input type="text" id="searchProducts" class="form-control search-box" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬Ø§Øª...">
        </div>
        <table class="table table-hover">
          <thead>
            <tr>
              <th onclick="sortTable(0, 'productsTable')">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th onclick="sortTable(1, 'productsTable')">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
              <th>âš™ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="productsTable"></tbody>
        </table>
      </div>
      
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
      <div class="tab-pane fade" id="sales">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-primary" onclick="newSale()">ğŸ›’ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©</button>
          <input type="text" id="searchSales" class="form-control search-box" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¨ÙŠØ¹Ø§Øª...">
        </div>
        <table class="table table-hover">
          <thead>
            <tr>
              <th onclick="sortTable(0, 'salesTable')">ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
              <th onclick="sortTable(1, 'salesTable')">ğŸ·ï¸ Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th onclick="sortTable(2, 'salesTable')">ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©</th>
              <th onclick="sortTable(3, 'salesTable')">ğŸ’¸ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
              <th onclick="sortTable(4, 'salesTable')">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>âš™ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="salesTable"></tbody>
        </table>
      </div>
      
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
      <div class="tab-pane fade" id="customers">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-primary" data-toggle="modal" data-target="#customerModal" onclick="resetCustomerForm()">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
          <input type="text" id="searchCustomers" class="form-control search-box" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„Ø§Ø¡...">
        </div>
        <table class="table table-hover">
          <thead>
            <tr>
              <th onclick="sortTable(0, 'customersTable')">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
              <th>âš™ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="customersTable"></tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© -->
  <div class="messages-footer">
    <h4 class="owner-text">Ù…Ø¹ØªØµÙ… Ø§Ù„ Ø·ÙˆÙ‚</h4>
    <div id="sidebarMessagesList"></div>
    <div class="text-center mt-3">
      <button class="btn btn-primary" onclick="openMessageModal()">Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©</button>
    </div>
  </div>
  
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø© / ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ -->
  <div class="modal fade" id="saleModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content glass-container">
        <div class="modal-header">
          <h5 class="modal-title" id="saleModalTitle">ğŸ›’ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©</h5>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="saleForm">
            <input type="hidden" id="saleId">
            <div class="form-group">
              <label>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
              <select class="form-control" id="saleCustomer" required></select>
            </div>
            <div class="form-group">
              <label>ğŸ·ï¸ Ø§Ù„Ù…Ù†ØªØ¬</label>
              <select class="form-control" id="saleProduct" required></select>
            </div>
            <div class="form-group">
              <label>ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©</label>
              <input type="number" class="form-control" id="saleQuantity" required>
            </div>
            <div class="form-group">
              <label>ğŸ’¸ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
              <input type="text" class="form-control" id="saleTotal" readonly required>
            </div>
            <div class="form-group">
              <label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
              <input type="date" class="form-control" id="saleDate" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
          <button type="button" class="btn btn-primary" onclick="saveSale()">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <div class="modal fade" id="productModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content glass-container">
        <div class="modal-header">
          <h5 class="modal-title" id="productModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h5>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="productForm">
            <input type="hidden" id="productId">
            <div class="form-group">
              <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
              <input type="text" class="form-control" id="productName" required>
            </div>
            <div class="form-group">
              <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</label>
              <input type="number" step="0.01" class="form-control" id="productSale" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
          <button type="button" class="btn btn-primary" onclick="saveProduct()">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
  <div class="modal fade" id="customerModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content glass-container">
        <div class="modal-header">
          <h5 class="modal-title" id="customerModalTitle">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h5>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="customerForm">
            <input type="hidden" id="customerId">
            <div class="form-group">
              <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
              <input type="text" class="form-control" id="customerName" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
          <button type="button" class="btn btn-primary" onclick="saveCustomer()">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    let products = JSON.parse(localStorage.getItem('products')) || [];
    let customers = JSON.parse(localStorage.getItem('customers')) || [];
    let sales = JSON.parse(localStorage.getItem('sales')) || [];
    let messages = JSON.parse(localStorage.getItem('messages')) || [];
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function saveData() {
      localStorage.setItem('products', JSON.stringify(products));
      localStorage.setItem('customers', JSON.stringify(customers));
      localStorage.setItem('sales', JSON.stringify(sales));
    }
    function saveMessagesData() {
      localStorage.setItem('messages', JSON.stringify(messages));
    }
    
    /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª */
    function renderSales() {
      const tbody = document.getElementById('salesTable');
      tbody.innerHTML = sales.map(sale => `
        <tr>
          <td>${sale.customer}</td>
          <td>${sale.product}</td>
          <td>${sale.quantity}</td>
          <td>${sale.total} ${sale.currency == "USD" ? "$" : sale.currency == "SAR" ? "SAR" : sale.currency == "OMR" ? "OMR" : ""}</td>
          <td>${sale.date}</td>
          <td>
            <button class="btn btn-warning btn-sm" onClick="editSale(${sale.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn btn-danger btn-sm" onClick="deleteSale(${sale.id})">ğŸ—‘ Ø­Ø°Ù</button>
          </td>
        </tr>
      `).join('');
    }
    function saveSale() {
      const saleId = document.getElementById('saleId').value;
      const saleCustomer = document.getElementById('saleCustomer').value;
      const saleProduct = document.getElementById('saleProduct').value;
      const saleQuantity = document.getElementById('saleQuantity').value;
      const saleTotalStr = document.getElementById('saleTotal').value;
      const saleTotalNum = parseFloat(saleTotalStr);
      const saleDate = document.getElementById('saleDate').value;
      const currentCurrencyCode = document.getElementById('currencySelector').value;
      
      if (saleId) {
        const sale = sales.find(s => s.id == saleId);
        if(sale){
          sale.customer = saleCustomer;
          sale.product = saleProduct;
          sale.quantity = saleQuantity;
          sale.total = saleTotalNum;
          sale.date = saleDate;
          sale.currency = currentCurrencyCode;
        }
      } else {
        sales.push({
          id: Date.now(),
          customer: saleCustomer,
          product: saleProduct,
          quantity: saleQuantity,
          total: saleTotalNum,
          date: saleDate,
          currency: currentCurrencyCode
        });
      }
      saveData();
      renderSales();
      $('#saleModal').modal('hide');
      document.getElementById('saleForm').reset();
    }
    function editSale(id) {
      const sale = sales.find(s => s.id == id);
      if (sale) {
        document.getElementById('saleId').value = sale.id;
        document.getElementById('saleCustomer').value = sale.customer;
        document.getElementById('saleProduct').value = sale.product;
        document.getElementById('saleQuantity').value = sale.quantity;
        document.getElementById('saleTotal').value = sale.total + " " + (sale.currency == "USD" ? "$" : sale.currency == "SAR" ? "SAR" : sale.currency == "OMR" ? "OMR" : "");
        document.getElementById('saleDate').value = sale.date;
        document.getElementById('saleModalTitle').textContent = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹';
        $('#saleModal').modal('show');
      }
    }
    function deleteSale(id) {
      if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')){
        sales = sales.filter(s => s.id != id);
        saveData();
        renderSales();
      }
    }
    
    /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    function renderProducts() {
      const tbody = document.getElementById('productsTable');
      tbody.innerHTML = products.map(product => `
        <tr>
          <td>${product.name}</td>
          <td>${product.sale}</td>
          <td>
            <button class="btn btn-warning btn-sm" onclick="editProduct(${product.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">ğŸ—‘ Ø­Ø°Ù</button>
          </td>
        </tr>
      `).join('');
    }
    function saveProduct() {
      const productId = document.getElementById('productId').value;
      const productName = document.getElementById('productName').value;
      const productSale = document.getElementById('productSale').value;
      if (productId) {
        const product = products.find(p => p.id == productId);
        if(product) {
          product.name = productName;
          product.sale = parseFloat(productSale);
        }
      } else {
        products.push({
          id: Date.now(),
          name: productName,
          sale: parseFloat(productSale)
        });
      }
      saveData();
      renderProducts();
      $('#productModal').modal('hide');
      resetProductForm();
    }
    function editProduct(id) {
      const product = products.find(p => p.id == id);
      if(product) {
         document.getElementById('productId').value = product.id;
         document.getElementById('productName').value = product.name;
         document.getElementById('productSale').value = product.sale;
         document.getElementById('productModalTitle').textContent = "âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬";
         $('#productModal').modal('show');
      }
    }
    function deleteProduct(id) {
      if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')){
         products = products.filter(p => p.id != id);
         saveData();
         renderProducts();
      }
    }
    function resetProductForm() {
      document.getElementById('productForm').reset();
      document.getElementById('productId').value = "";
      document.getElementById('productModalTitle').textContent = "Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯";
    }
    
    /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ */
    function renderCustomers() {
      const tbody = document.getElementById('customersTable');
      tbody.innerHTML = customers.map(customer => `
        <tr>
          <td>${customer.name}</td>
          <td>
            <button class="btn btn-warning btn-sm" onclick="editCustomer(${customer.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn btn-danger btn-sm" onclick="deleteCustomer(${customer.id})">ğŸ—‘ Ø­Ø°Ù</button>
          </td>
        </tr>
      `).join('');
    }
    function saveCustomer() {
      const customerId = document.getElementById('customerId').value;
      const customerName = document.getElementById('customerName').value;
      if (customerId) {
        const customer = customers.find(c => c.id == customerId);
        if(customer) {
          customer.name = customerName;
        }
      } else {
        customers.push({
          id: Date.now(),
          name: customerName
        });
      }
      saveData();
      renderCustomers();
      $('#customerModal').modal('hide');
      resetCustomerForm();
    }
    function editCustomer(id) {
      const customer = customers.find(c => c.id == id);
      if(customer) {
        document.getElementById('customerId').value = customer.id;
        document.getElementById('customerName').value = customer.name;
        document.getElementById('customerModalTitle').textContent = "âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„";
        $('#customerModal').modal('show');
      }
    }
    function deleteCustomer(id) {
      if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')){
         customers = customers.filter(c => c.id != id);
         saveData();
         renderCustomers();
      }
    }
    function resetCustomerForm() {
      document.getElementById('customerForm').reset();
      document.getElementById('customerId').value = "";
      document.getElementById('customerModalTitle').textContent = "Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯";
    }
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
    let currentCurrencyRate = 1;
    let currentCurrencySymbol = "$";
    
    // ØªØ¹Ø¨Ø¦Ø© Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ¹ Ù„Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    function populateSaleModal() {
      const customerSelect = document.getElementById('saleCustomer');
      if(customers.length){
        customerSelect.innerHTML = customers.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
      } else {
        customerSelect.innerHTML = `<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</option>`;
      }
      const productSelect = document.getElementById('saleProduct');
      if(products.length){
        productSelect.innerHTML = products.map(p => `<option value="${p.name}" data-sale="${p.sale}">${p.name}</option>`).join('');
      } else {
        productSelect.innerHTML = `<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</option>`;
      }
      document.getElementById('saleQuantity').value = 1;
      updateSaleTotal();
    }
    function updateSaleTotal() {
      const productSelect = document.getElementById('saleProduct');
      const selectedOption = productSelect.options[productSelect.selectedIndex];
      const salePrice = parseFloat(selectedOption.getAttribute('data-sale')) || 0;
      const quantity = parseFloat(document.getElementById('saleQuantity').value) || 1;
      const total = salePrice * quantity * currentCurrencyRate;
      document.getElementById('saleTotal').value = total.toFixed(2) + " " + currentCurrencySymbol;
    }
    document.getElementById('saleProduct').addEventListener('change', updateSaleTotal);
    document.getElementById('saleQuantity').addEventListener('input', updateSaleTotal);
    
    function newSale() {
      document.getElementById('saleForm').reset();
      document.getElementById('saleId').value = "";
      document.getElementById('saleModalTitle').textContent = "ğŸ›’ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©";
      populateSaleModal();
      $('#saleModal').modal('show');
    }
    
    document.getElementById('currencySelector').addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      currentCurrencyRate = parseFloat(selectedOption.getAttribute('data-rate'));
      currentCurrencySymbol = selectedOption.getAttribute('data-symbol');
      updateSaleTotal();
    });
    
    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
    function checkPassword() {
      const entered = document.getElementById('sitePassword').value;
      if(entered === "00almutasim") {
        $('#passwordModal').modal('hide');
      } else {
        alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        document.getElementById('sitePassword').value = "";
      }
    }
    
    // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø«Ù… Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
    $(window).on('load', function() {
      $("#preloader").fadeOut(2500, function() {
        $('#passwordModal').modal('show');
      });
    });
    
    document.addEventListener('DOMContentLoaded', () => {
      renderSales();
      renderProducts();
      renderCustomers();
      // Ø¯ÙˆØ§Ù„ Ø£Ø®Ø±Ù‰ Ù…Ø«Ù„ renderSidebarMessages ÙˆØºÙŠØ±Ù‡Ø§ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
    });
  </script>
  
</body>
</html>
